(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{796:function(t,s,e){"use strict";e.r(s);var a=e(13),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"ngx-http-stub-status-监控链接信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ngx-http-stub-status-监控链接信息"}},[t._v("#")]),t._v(" ngx_http_stub_status 监控链接信息")]),t._v(" "),e("p",[t._v("是 nginx 自带的一个模块，可以使用命令查看是否已经编译进来了")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("nginx -V\nnginx version: nginx/1.17.4\nbuilt by cl "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("16.00")]),t._v(".40219.01 "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" 80x86\nbuilt with OpenSSL "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),t._v(".1d  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" Sep "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("\nTLS SNI support enabled\nconfigure arguments: --with-cc"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("cl --builddir"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("objs.msvc8 --with-debug --prefix"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" --conf-path"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("conf/nginx.conf --pid-path"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("logs/nginx.pid --http-log-path"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("logs/access.log --error-log-path"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("logs/error.log --sbin-path"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx.exe --http-client-body-temp-path"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("temp/client_body_temp --http-proxy-temp-path"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("temp/proxy_temp --http-fastcgi-temp-path"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("temp/fastcgi_temp --http-scgi-temp-path"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("temp/scgi_temp --http-uwsgi-temp-path"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("temp/uwsgi_temp --with-cc-opt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-DFD_SETSIZE"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" --with-pcre"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("objs.msvc8/lib/pcre-8.43 --with-zlib"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("objs.msvc8/lib/zlib-1.2.11 --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_stub_status_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_random_index_module --with-http_secure_link_module --with-http_slice_module --with-mail --with-stream --with-openssl"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("objs.msvc8/lib/openssl-1.1.1d --with-openssl-opt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no-asm no-tests -D_WIN32_WINNT=0x0501'")]),t._v(" --with-http_ssl_module --with-mail_ssl_module --with-stream_ssl_module\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])]),e("p",[t._v("也就是这个 "),e("code",[t._v("--with-http_stub_status_module")])]),t._v(" "),e("p",[t._v("增加配置")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("location "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /nginx_status "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n stub_status on"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启这个状态信息")]),t._v("\n access_log off"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n allow "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行本机访问，其他的都拒绝")]),t._v("\n deny all"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])]),e("p",[t._v("重新加载配置后，访问 "),e("code",[t._v("http://localhost/nginx_status")]),t._v("，有以下的内容输出")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Active connections: 2 \t\t\t\t\t\t\t\t\t\nserver accepts handled requests\n 4 \t\t\t4 \t\t\t\t2\t\t\t\t3 \nReading: 0 Writing: 1 Waiting: 1 \n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("p",[t._v("以上信息与如何使用在官方文档中也有，"),e("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_stub_status_module.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("就是具体的模块文档里面"),e("OutboundLink")],1)]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Active connections")]),t._v(" "),e("p",[t._v("当前活动的客户端连接数，包括"),e("code",[t._v("Waiting")]),t._v("连接数。")])]),t._v(" "),e("li",[e("p",[t._v("accepts")]),t._v(" "),e("p",[t._v("接受的客户端连接总数。")])]),t._v(" "),e("li",[e("p",[t._v("handled")]),t._v(" "),e("p",[t._v("已处理的连接总数。通常，参数值与 "),e("code",[t._v("accepts")]),t._v("  除非达到某些资源限制（例如， "),e("a",{attrs:{href:"http://nginx.org/en/docs/ngx_core_module.html#worker_connections",target:"_blank",rel:"noopener noreferrer"}},[t._v("worker_connections"),e("OutboundLink")],1),t._v(" 限制）相同。")])]),t._v(" "),e("li",[e("p",[t._v("requests")]),t._v(" "),e("p",[t._v("客户端请求总数。")])]),t._v(" "),e("li",[e("p",[t._v("Reading")]),t._v(" "),e("p",[t._v("nginx 正在读取请求标头的当前连接数。")])]),t._v(" "),e("li",[e("p",[t._v("Writing")]),t._v(" "),e("p",[t._v("nginx 正在将响应写回到客户端的当前连接数。")])]),t._v(" "),e("li",[e("p",[t._v("Waiting")]),t._v(" "),e("p",[t._v("当前等待请求的空闲客户端连接数。")])])]),t._v(" "),e("p",[t._v("其中后 5 个信息比较重要，可以知道当前的 nginx 是否繁忙")])])}),[],!1,null,null,null);s.default=n.exports}}]);
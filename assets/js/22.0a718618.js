(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{666:function(s,a,t){s.exports=t.p+"assets/img/image-20210117221823485.d8b63745.png"},667:function(s,a,t){s.exports=t.p+"assets/img/image-20210117223157306.f0ddf327.png"},668:function(s,a,t){s.exports=t.p+"assets/img/image-20210117223134434.2164c1c2.png"},669:function(s,a,t){s.exports=t.p+"assets/img/image-20210117223254593.a4eaae41.png"},670:function(s,a,t){s.exports=t.p+"assets/img/image-20210117231350994.5e7d4564.png"},671:function(s,a,t){s.exports=t.p+"assets/img/image-20210117232009897.bae2ec5e.png"},786:function(s,a,t){"use strict";t.r(a);var e=t(13),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"监控远程-java-进程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#监控远程-java-进程"}},[s._v("#")]),s._v(" 监控远程 JAVA 进程")]),s._v(" "),e("h2",{attrs:{id:"tomcat"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tomcat"}},[s._v("#")]),s._v(" Tomcat")]),s._v(" "),e("p",[s._v("可以通过「远程」功能来添加远程的 Tomcat 进程，不只是 Tomcat，只要是 Java 进程都可以")]),s._v(" "),e("p",[e("img",{attrs:{src:t(666),alt:"image-20210117221823485"}})]),s._v(" "),e("p",[s._v("但是连接远程进程是需要在远端进行配置的。拿 Tomcat 来说，需要修改 "),e("code",[s._v("Catalina.sh")]),s._v(" 配置文件，也就是增加 JMX 相关参数")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('JAVA OPTS="$JAVA OPTS -Dcom.sun.management.jmxremote\n-Dcom.sun.management.jmxremote.port=9004\n-Dcom.sun.management.jmxremote.authenticate=false\n-Dcom.sun.management.jmxremote.ssl=false\n-Djava.net.preferlPv4Stack=true\n-Djava.rmi.server.hostname=10.110.3.62"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("ul",[e("li",[s._v("port：访问到 jmx 服务的端口")]),s._v(" "),e("li",[s._v("authenticate：是否认证")]),s._v(" "),e("li",[s._v("ssl")]),s._v(" "),e("li",[s._v("preferlPv4Stack：优先使用 iPv4Stack")]),s._v(" "),e("li",[s._v("hostname：访问到该服务的 IP 地址，外部通过哪个 IP 能访问到本服务")])]),s._v(" "),e("p",[s._v("它是可以添加 JMX 和  jstatd 链接的")]),s._v(" "),e("p",[e("img",{attrs:{src:t(667),alt:"image-20210117223157306"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(668),alt:"image-20210117223134434"}})]),s._v(" "),e("p",[s._v("上图这样就可以连接上了，链接之后的就和上一节本地连接中的是一样的了")]),s._v(" "),e("p",[e("img",{attrs:{src:t(669),alt:"image-20210117223254593"}})]),s._v(" "),e("h2",{attrs:{id:"spring-boot-jar"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#spring-boot-jar"}},[s._v("#")]),s._v(" Spring boot Jar")]),s._v(" "),e("p",[s._v("由于笔者手里没有 tomcat 程序，就使用我们练习的 spring boot 程序，打成 jar 包后，来启动")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("mrcode@mrcode libs % java -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9004")]),s._v(" -Dcom.sun.management.jmxremote.authenticate"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false -Dcom.sun.management.jmxremote.ssl"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false -Djava.net.preferlPv4Stack"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -Djava.rmi.server.hostname"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -jar monitor-tuning-0.0.1-SNAPSHOT.jar\n错误: 找不到口令文件: /Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/lib/management/jmxremote.password\nsun.management.AgentConfigurationError\n\tat sun.management.jmxremote.ConnectorBootstrap.checkPasswordFile"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ConnectorBootstrap.java:563"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tat sun.management.jmxremote.ConnectorBootstrap.startRemoteConnectorServer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ConnectorBootstrap.java:426"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tat sun.management.Agent.startAgent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Agent.java:262"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tat sun.management.Agent.startAgent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Agent.java:452"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("在 mac 下发现报错了，于是去该路径看看，发现有一个 password 的模板文件，我们这里复制一份修改一下")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("mrcode:chapter2 mrcode$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /Library/Internet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/lib/management/jmxremote.\njmxremote.access             jmxremote.password.template\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mac 上要切换到 root  用户下才有权限")]),s._v("\nmrcode:management mrcode$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" -\nPassword:\n\nmrcode:management root"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp jmxremote.password.template jmxremote.password")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再次运行还是报错")]),s._v("\n错误: 必须限制口令文件读取访问权限: /Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/lib/management/jmxremote.password\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 那么这个里面就说了，由于安全问题，该文件必须要限制它的权限，而且是文件的所有者才能进行访问")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里看看它的权限")]),s._v("\nmrcode:management root"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -l")]),s._v("\ntotal "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n-rw-r--r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root  wheel   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3998")]),s._v(" Dec "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" jmxremote.access\n-rw-r--r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root  wheel   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2854")]),s._v(" Jan "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":01 jmxremote.password\n-rw-r--r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root  wheel   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2856")]),s._v(" Dec "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" jmxremote.password.template\n-rw-r--r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root  wheel  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("14630")]),s._v(" Dec "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" management.properties\n-rw-r--r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root  wheel   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3376")]),s._v(" Dec "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" snmp.acl.template\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改文件权限为 600 也就是，只有文件拥有者有读写权限")]),s._v("\nmrcode:management root$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" jmxremote.password\nmrcode:management root$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l jmxremote.password\n-rw-------  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root  wheel  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2854")]),s._v(" Jan "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":01 jmxremote.password\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解决所有的问题之后，再次运行就成功了")]),s._v("\nmrcode:libs root$ java -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9004")]),s._v(" -Dcom.sun management.jmxremote.authenticate"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false -Dcom.sun management.jmxremote.ssl"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false -Djava.net.preferlPv4Stack"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true-Djava.rmi.server.hostname"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -jar monitor-tuning-0.0.1-SNAPSHOT.jar\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br")])]),e("p",[e("img",{attrs:{src:t(670),alt:"image-20210117231350994"}})]),s._v(" "),e("p",[s._v("由于不能写 localhost 或则 127.0.0.1 这种的，写了之后也会归类到本地，为什么会这样，你看看本地这个属性就明白了")]),s._v(" "),e("p",[e("img",{attrs:{src:t(671),alt:"image-20210117232009897"}})]),s._v(" "),e("p",[s._v("可以看到这个就是一个内置的方式。通过自己添加的 Visual GC 这个插件显示不支持此 JVM，可能还是有哪里有问题把。")]),s._v(" "),e("h3",{attrs:{id:"远程-jmx-用户名密码访问"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#远程-jmx-用户名密码访问"}},[s._v("#")]),s._v(" 远程 jmx 用户名密码访问")]),s._v(" "),e("p",[s._v("如果你怕你远程应用不设置用户密码，不安全的话，可以使用用户名密码进行访问，也就是前面说到过的 jmxremote.password 文件中，一行一个，比如")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 用户名   密码\njmxuser   111111\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);
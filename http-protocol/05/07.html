<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>07 | 我应该迁移到 HTTPS 吗？ | NOTE-BOOK2</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/notebook/favicon.ico">
    <link rel="manifest" href="/notebook/manifest.json">
    <meta name="description" content="note-book 的第二分仓笔记仓库">
    
    <link rel="preload" href="/notebook/assets/css/0.styles.36b9479e.css" as="style"><link rel="preload" href="/notebook/assets/js/app.b6298c27.js" as="script"><link rel="preload" href="/notebook/assets/js/2.64eb5107.js" as="script"><link rel="preload" href="/notebook/assets/js/59.5bb43d22.js" as="script"><link rel="preload" href="/notebook/assets/js/50.da39fd24.js" as="script"><link rel="prefetch" href="/notebook/assets/js/10.f2f15088.js"><link rel="prefetch" href="/notebook/assets/js/100.b7a284fd.js"><link rel="prefetch" href="/notebook/assets/js/101.54042053.js"><link rel="prefetch" href="/notebook/assets/js/102.5bab3651.js"><link rel="prefetch" href="/notebook/assets/js/103.3d283f19.js"><link rel="prefetch" href="/notebook/assets/js/104.2fbe9651.js"><link rel="prefetch" href="/notebook/assets/js/105.3e2ec64c.js"><link rel="prefetch" href="/notebook/assets/js/106.25ccda3b.js"><link rel="prefetch" href="/notebook/assets/js/107.90cc2754.js"><link rel="prefetch" href="/notebook/assets/js/108.4e4472c8.js"><link rel="prefetch" href="/notebook/assets/js/109.8c927ccc.js"><link rel="prefetch" href="/notebook/assets/js/11.57132374.js"><link rel="prefetch" href="/notebook/assets/js/110.6e9ab0a5.js"><link rel="prefetch" href="/notebook/assets/js/111.cf4db3b8.js"><link rel="prefetch" href="/notebook/assets/js/112.db9efc72.js"><link rel="prefetch" href="/notebook/assets/js/113.bc497656.js"><link rel="prefetch" href="/notebook/assets/js/114.7b29fa0f.js"><link rel="prefetch" href="/notebook/assets/js/115.6ecd72ad.js"><link rel="prefetch" href="/notebook/assets/js/116.714ba37d.js"><link rel="prefetch" href="/notebook/assets/js/117.20fc6ca9.js"><link rel="prefetch" href="/notebook/assets/js/118.23c68cc5.js"><link rel="prefetch" href="/notebook/assets/js/119.22353b91.js"><link rel="prefetch" href="/notebook/assets/js/12.e186564a.js"><link rel="prefetch" href="/notebook/assets/js/13.8f2e6b3f.js"><link rel="prefetch" href="/notebook/assets/js/14.5af7e630.js"><link rel="prefetch" href="/notebook/assets/js/15.2ee25eab.js"><link rel="prefetch" href="/notebook/assets/js/16.0f760848.js"><link rel="prefetch" href="/notebook/assets/js/17.82010583.js"><link rel="prefetch" href="/notebook/assets/js/18.94bb2fcd.js"><link rel="prefetch" href="/notebook/assets/js/19.8d83e367.js"><link rel="prefetch" href="/notebook/assets/js/20.9853e81d.js"><link rel="prefetch" href="/notebook/assets/js/21.a60e512a.js"><link rel="prefetch" href="/notebook/assets/js/22.0a718618.js"><link rel="prefetch" href="/notebook/assets/js/23.d0085c3c.js"><link rel="prefetch" href="/notebook/assets/js/24.64c99be0.js"><link rel="prefetch" href="/notebook/assets/js/25.7f138222.js"><link rel="prefetch" href="/notebook/assets/js/26.c38b4f1f.js"><link rel="prefetch" href="/notebook/assets/js/27.3c23ee36.js"><link rel="prefetch" href="/notebook/assets/js/28.17a30eb5.js"><link rel="prefetch" href="/notebook/assets/js/29.1080ae7e.js"><link rel="prefetch" href="/notebook/assets/js/3.39c53e9a.js"><link rel="prefetch" href="/notebook/assets/js/30.e12e7194.js"><link rel="prefetch" href="/notebook/assets/js/31.1b4d10d3.js"><link rel="prefetch" href="/notebook/assets/js/32.088b464e.js"><link rel="prefetch" href="/notebook/assets/js/33.b6d5b301.js"><link rel="prefetch" href="/notebook/assets/js/34.07a7bd18.js"><link rel="prefetch" href="/notebook/assets/js/35.c1778ec0.js"><link rel="prefetch" href="/notebook/assets/js/36.9c952bcf.js"><link rel="prefetch" href="/notebook/assets/js/37.538120d6.js"><link rel="prefetch" href="/notebook/assets/js/38.379b1ac9.js"><link rel="prefetch" href="/notebook/assets/js/39.9825dc44.js"><link rel="prefetch" href="/notebook/assets/js/4.80b43ba9.js"><link rel="prefetch" href="/notebook/assets/js/40.7502629c.js"><link rel="prefetch" href="/notebook/assets/js/41.e918a100.js"><link rel="prefetch" href="/notebook/assets/js/42.6d79fd40.js"><link rel="prefetch" href="/notebook/assets/js/43.f40c79b3.js"><link rel="prefetch" href="/notebook/assets/js/44.66b4fb8b.js"><link rel="prefetch" href="/notebook/assets/js/45.58d7b7db.js"><link rel="prefetch" href="/notebook/assets/js/46.3e86cb70.js"><link rel="prefetch" href="/notebook/assets/js/47.1ceb15d6.js"><link rel="prefetch" href="/notebook/assets/js/48.7405fe2c.js"><link rel="prefetch" href="/notebook/assets/js/49.f512df2d.js"><link rel="prefetch" href="/notebook/assets/js/5.a817fe71.js"><link rel="prefetch" href="/notebook/assets/js/51.1befb9db.js"><link rel="prefetch" href="/notebook/assets/js/52.ee2cc35e.js"><link rel="prefetch" href="/notebook/assets/js/53.b7d4d642.js"><link rel="prefetch" href="/notebook/assets/js/54.7597b610.js"><link rel="prefetch" href="/notebook/assets/js/55.b99d68c9.js"><link rel="prefetch" href="/notebook/assets/js/56.3260f107.js"><link rel="prefetch" href="/notebook/assets/js/57.4c3d32ae.js"><link rel="prefetch" href="/notebook/assets/js/58.858f5030.js"><link rel="prefetch" href="/notebook/assets/js/6.e66ff3e3.js"><link rel="prefetch" href="/notebook/assets/js/60.604f3715.js"><link rel="prefetch" href="/notebook/assets/js/61.133da1fe.js"><link rel="prefetch" href="/notebook/assets/js/62.b9d97f09.js"><link rel="prefetch" href="/notebook/assets/js/63.b54ac379.js"><link rel="prefetch" href="/notebook/assets/js/64.11aa21b9.js"><link rel="prefetch" href="/notebook/assets/js/65.f7fc56f3.js"><link rel="prefetch" href="/notebook/assets/js/66.11cdb117.js"><link rel="prefetch" href="/notebook/assets/js/67.c393eaf5.js"><link rel="prefetch" href="/notebook/assets/js/68.ee9541b2.js"><link rel="prefetch" href="/notebook/assets/js/69.d3d86051.js"><link rel="prefetch" href="/notebook/assets/js/7.cf57fdd5.js"><link rel="prefetch" href="/notebook/assets/js/70.8466e474.js"><link rel="prefetch" href="/notebook/assets/js/71.e4c9766c.js"><link rel="prefetch" href="/notebook/assets/js/72.efa3abc7.js"><link rel="prefetch" href="/notebook/assets/js/73.534593d2.js"><link rel="prefetch" href="/notebook/assets/js/74.74bf2cc7.js"><link rel="prefetch" href="/notebook/assets/js/75.84a69486.js"><link rel="prefetch" href="/notebook/assets/js/76.6a4151a2.js"><link rel="prefetch" href="/notebook/assets/js/77.bc69de12.js"><link rel="prefetch" href="/notebook/assets/js/78.ef857f92.js"><link rel="prefetch" href="/notebook/assets/js/79.a994a308.js"><link rel="prefetch" href="/notebook/assets/js/8.1e1b7412.js"><link rel="prefetch" href="/notebook/assets/js/80.bb3ad06d.js"><link rel="prefetch" href="/notebook/assets/js/81.65c1333d.js"><link rel="prefetch" href="/notebook/assets/js/82.261800cd.js"><link rel="prefetch" href="/notebook/assets/js/83.44998c31.js"><link rel="prefetch" href="/notebook/assets/js/84.85b6a88a.js"><link rel="prefetch" href="/notebook/assets/js/85.9a33a277.js"><link rel="prefetch" href="/notebook/assets/js/86.1d5b478f.js"><link rel="prefetch" href="/notebook/assets/js/87.a2ea9583.js"><link rel="prefetch" href="/notebook/assets/js/88.aa84de6d.js"><link rel="prefetch" href="/notebook/assets/js/89.9f568c0c.js"><link rel="prefetch" href="/notebook/assets/js/9.bfb9d1de.js"><link rel="prefetch" href="/notebook/assets/js/90.83f66c97.js"><link rel="prefetch" href="/notebook/assets/js/91.7eec9066.js"><link rel="prefetch" href="/notebook/assets/js/92.edafca68.js"><link rel="prefetch" href="/notebook/assets/js/93.a12f5c78.js"><link rel="prefetch" href="/notebook/assets/js/94.bdaa08e2.js"><link rel="prefetch" href="/notebook/assets/js/95.37064771.js"><link rel="prefetch" href="/notebook/assets/js/96.610fe9bd.js"><link rel="prefetch" href="/notebook/assets/js/97.5f6322c4.js"><link rel="prefetch" href="/notebook/assets/js/98.175c6f9c.js"><link rel="prefetch" href="/notebook/assets/js/99.e9545cc8.js">
    <link rel="stylesheet" href="/notebook/assets/css/0.styles.36b9479e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook/" class="home-link router-link-active"><img src="/notebook/mlogo.svg" alt="NOTE-BOOK2" class="logo"> <span class="site-name can-hide">NOTE-BOOK2</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notebook/monitor-tuning/" class="nav-link">
  JAVA 生产环境下性能监控与调优详解
</a></div><div class="nav-item"><a href="/notebook/http-protocol/" class="nav-link router-link-active">
  透视 HTTP 协议
</a></div><div class="nav-item"><a href="/notebook/ddd/" class="nav-link">
  DDD 实战课
</a></div> <a href="https://github.com/nianien/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notebook/monitor-tuning/" class="nav-link">
  JAVA 生产环境下性能监控与调优详解
</a></div><div class="nav-item"><a href="/notebook/http-protocol/" class="nav-link router-link-active">
  透视 HTTP 协议
</a></div><div class="nav-item"><a href="/notebook/ddd/" class="nav-link">
  DDD 实战课
</a></div> <a href="https://github.com/nianien/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/notebook/http-protocol/" aria-current="page" class="sidebar-link">透视 HTTP 协议</a></li><li><a href="/notebook/http-protocol/01/" class="sidebar-link">01 | 开篇: To Be a HTTP Hero</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/notebook/http-protocol/02/" class="sidebar-heading clickable"><span>02 | 破冰篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notebook/http-protocol/03/" class="sidebar-heading clickable"><span>03 | 基础篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notebook/http-protocol/04/" class="sidebar-heading clickable"><span>04 | 进阶篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notebook/http-protocol/05/" class="sidebar-heading clickable router-link-active open"><span>05 | 安全篇</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook/http-protocol/05/01.html" class="sidebar-link">01 | TLS 又是什么？</a></li><li><a href="/notebook/http-protocol/05/02.html" class="sidebar-link">02 | 固若金汤的根本: 对称加密与非对称加密</a></li><li><a href="/notebook/http-protocol/05/03.html" class="sidebar-link">03 | 固若金汤的根本: 数字签名与证书</a></li><li><a href="/notebook/http-protocol/05/04.html" class="sidebar-link">04 | 信任始于握手: TLS 1.2 连接过程解析</a></li><li><a href="/notebook/http-protocol/05/05.html" class="sidebar-link">05 | 更好更快的握手: TLS 1.3 特性解析</a></li><li><a href="/notebook/http-protocol/05/06.html" class="sidebar-link">06 | 连接太慢该怎么办 HTTPS 的优化</a></li><li><a href="/notebook/http-protocol/05/07.html" aria-current="page" class="active sidebar-link">07 | 我应该迁移到 HTTPS 吗？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/http-protocol/05/07.html#迁移的必要性" class="sidebar-link">迁移的必要性</a></li><li class="sidebar-sub-header"><a href="/notebook/http-protocol/05/07.html#迁移的顾虑" class="sidebar-link">迁移的顾虑</a></li><li class="sidebar-sub-header"><a href="/notebook/http-protocol/05/07.html#申请证书" class="sidebar-link">申请证书</a></li><li class="sidebar-sub-header"><a href="/notebook/http-protocol/05/07.html#配置-https" class="sidebar-link">配置 HTTPS</a></li><li class="sidebar-sub-header"><a href="/notebook/http-protocol/05/07.html#服务器名称指示" class="sidebar-link">服务器名称指示</a></li><li class="sidebar-sub-header"><a href="/notebook/http-protocol/05/07.html#重定向跳转" class="sidebar-link">重定向跳转</a></li><li class="sidebar-sub-header"><a href="/notebook/http-protocol/05/07.html#小结" class="sidebar-link">小结</a></li><li class="sidebar-sub-header"><a href="/notebook/http-protocol/05/07.html#课下作业" class="sidebar-link">课下作业</a></li><li class="sidebar-sub-header"><a href="/notebook/http-protocol/05/07.html#拓展阅读" class="sidebar-link">拓展阅读</a></li><li class="sidebar-sub-header"><a href="/notebook/http-protocol/05/07.html#let-s-encrypt-证书-certbot-启动续期" class="sidebar-link">Let’s Encrypt 证书 certbot 启动续期</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notebook/http-protocol/06/" class="sidebar-heading clickable"><span>06 | 飞翔篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notebook/http-protocol/07/" class="sidebar-heading clickable"><span>07 | 探索篇</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/notebook/http-protocol/08/" class="sidebar-link">08 | 总结篇: HTTP 性能优化面面观</a></li><li><a href="/notebook/http-protocol/09.html" class="sidebar-link">参考资源</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_07-我应该迁移到-https-吗"><a href="#_07-我应该迁移到-https-吗" class="header-anchor">#</a> 07 | 我应该迁移到 HTTPS 吗？</h1> <p>今天是安全篇的最后一讲，我们已经学完了 HTTPS、TLS 相关的大部分知识。不过，或许你心里还会有一些困惑：</p> <p>HTTPS 这么复杂，我是否应该迁移到 HTTPS 呢？它能带来哪些好处呢？具体又应该怎么实施迁移呢？</p> <p>这些问题不单是你，也是其他很多人，还有当初的我的真实想法，所以今天我就来跟你聊聊这方面的事情。</p> <h2 id="迁移的必要性"><a href="#迁移的必要性" class="header-anchor">#</a> 迁移的必要性</h2> <p>如果你做移动应用开发的话，那么就一定知道，Apple、Android、某信等开发平台在 2017 年就相继发出通知，要求所有的应用必须使用 HTTPS 连接，禁止不安全的 HTTP。</p> <p>在台式机上，主流的浏览器 Chrome、Firefox 等也早就开始强推 HTTPS，把 HTTP 站点打上不安全的标签，给用户以心理压力。</p> <p>Google 等搜索巨头还利用自身的话语权优势，降低 HTTP 站点的排名，而给 HTTPS 更大的权重，力图让网民只访问到 HTTPS 网站。</p> <p>这些手段都逐渐挤压了纯明文 HTTP 的生存空间，迁移到 HTTPS已经不是要不要做的问题，而是要怎么做的问题了。HTTPS 的大潮无法阻挡，如果还是死守着 HTTP，那么无疑会被冲刷到互联网的角落里。</p> <p>目前国内外的许多知名大站都已经实现了 <strong>全站 HTTPS</strong> ，打开常用的某宝、某东、某浪，</p> <p>都可以在浏览器的地址栏里看到「小锁头」，如果你正在维护的网站还没有实施 HTTPS，那可要抓点紧了。</p> <h2 id="迁移的顾虑"><a href="#迁移的顾虑" class="header-anchor">#</a> 迁移的顾虑</h2> <p>据我观察，阻碍 HTTPS 实施的因素还有一些这样、那样的顾虑，我总结出了三个比较流行的观点：慢、贵、难</p> <ul><li><p>慢</p> <p>是指惯性思维，拿以前的数据来评估 HTTPS 的性能，认为 HTTPS 会增加服务器的成本，增加客户端的时延，影响用户体验。</p> <p>其实现在服务器和客户端的运算能力都已经有了很大的提升，性能方面完全没有担心的必要，而且还可以应用很多的优化解决方案。根据 Google 等公司的评估，在经过适当优化之后，HTTPS 的额外 CPU 成本小于 1%，额外的网络成本小于 2%，可以说是与无加密的 HTTP 相差无几</p></li> <li><p>贵</p> <p>主要是指证书申请和维护的成本太高，网站难以承担。</p> <p>这也属于惯性思维，在早几年的确是个问题，向 CA 申请证书的过程不仅麻烦，而且价格昂贵，每年要交几千甚至几万元。</p> <p>但现在就不一样了，为了推广 HTTPS，很多云服务厂商都提供了一键申请、价格低廉的证书，而且还出现了专门颁发免费证书的 CA，其中最著名的就是 <strong>Let’s Encrypt</strong> 。</p></li> <li><p>难</p> <p>是指 HTTPS 涉及的知识点太多、太复杂，有一定的技术门槛，不能很快上手。</p> <p>这第三个顾虑比较现实，HTTPS 背后关联到了密码学、TLS、PKI 等许多领域，不是短短几周、几个月就能够精通的。但实施 HTTPS 也并不需要把这些完全掌握，只要抓住少数几个要点就好，下面我就来帮你逐个解决一些关键的难点 。</p></li></ul> <h2 id="申请证书"><a href="#申请证书" class="header-anchor">#</a> 申请证书</h2> <p>要把网站从 HTTP 切换到 HTTPS，首先要做的就是为网站申请一张证书。</p> <p>大型网站出于信誉、公司形象的考虑，通常会选择向传统的 CA 申请证书，例如 DigiCert、GlobalSign，而中小型网站完全可以选择使用 <code>Let’s Encrypt</code> 这样的免费证书，效果也完全不输于那些收费的证书。</p> <p><strong>Let’s Encrypt</strong> 一直在推动证书的自动化部署，为此还实现了专门的 ACME 协议（RFC8555）。有很多的客户端软件可以完成申请、验证、下载、更新的一条龙操作，比如 Certbot、acme.sh 等等，都可以在 Let’s Encrypt 网站上找到，用法很简单，相关的文档也很详细，几分钟就能完成申请，所以我在这里就不细说了。</p> <p>不过我必须提醒你几个注意事项。</p> <ul><li><p>第一，申请证书时应当同时申请 RSA 和 ECDSA 两种证书，在 Nginx 里配置成 <strong>双证书验证</strong> ，这样服务器可以自动选择快速的椭圆曲线证书，同时也兼容只支持 RSA 的客户端。</p></li> <li><p>第二，如果申请 RSA 证书，私钥至少要 2048 位，摘要算法应该选用 SHA-2，例如 SHA256、SHA384 等。</p></li> <li><p>第三，出于安全的考虑，Let’s Encrypt 证书的有效期很短，只有 90 天，时间一到就会过期失效，所以必须要定期更新。你可以在 crontab 里加个每周或每月任务，发送更新请求，不过很多 ACME 客户端会自动添加这样的定期任务，完全不用你操心</p></li></ul> <h2 id="配置-https"><a href="#配置-https" class="header-anchor">#</a> 配置 HTTPS</h2> <p>搞定了证书，接下来就是配置 Web 服务器，在 443 端口上开启 HTTPS 服务了。</p> <p>这在 Nginx 上非常简单，只要在 <code>listen</code> 指令后面加上参数 <code>ssl</code> ，再配上刚才的证书文件就可以实现最基本的 HTTPS</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>listen                <span class="token number">443</span> ssl<span class="token punctuation">;</span>
 
ssl_certificate       xxx_rsa.crt<span class="token punctuation">;</span>  <span class="token comment"># rsa2048 cert</span>
ssl_certificate_key   xxx_rsa.key<span class="token punctuation">;</span>  <span class="token comment"># rsa2048 private key</span>
 
ssl_certificate       xxx_ecc.crt<span class="token punctuation">;</span>  <span class="token comment"># ecdsa cert</span>
ssl_certificate_key   xxx_ecc.key<span class="token punctuation">;</span>  <span class="token comment"># ecdsa private ke</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>为了提高 HTTPS 的安全系数和性能，你还可以强制 Nginx 只支持 TLS1.2 以上的协议，打开 <code>Session Ticket</code> 会话复用：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ssl_protocols               TLSv1.2 TLSv1.3<span class="token punctuation">;</span>
 
ssl_session_timeout         5m<span class="token punctuation">;</span>
ssl_session_tickets         on<span class="token punctuation">;</span>
ssl_session_ticket_key      ticket.key<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>密码套件的选择方面，我给你的建议是以服务器的套件优先。这样可以避免恶意客户端故意选择较弱的套件、降低安全等级，然后密码套件向 TLS1.3 看齐，只使用 ECDHE、AES 和 ChaCha20，支持 <code>False Start</code> 。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ssl_prefer_server_ciphers   on<span class="token punctuation">;</span>
 
ssl_ciphers   ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-CHACHA20-POLY1305:ECDHE+AES128:<span class="token operator">!</span>MD5:<span class="token operator">!</span>SHA1<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果你的服务器上使用了 OpenSSL 的分支 BorringSSL，那么还可以使用一个特殊的 等价密码组（Equal preference cipher groups）特性，它可以让服务器配置一组等价的密码套件，在这些套件里允许客户端优先选择，比如这么配置：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ssl_ciphers 
<span class="token punctuation">[</span>ECDHE-ECDSA-AES128-GCM-SHA256<span class="token operator">|</span>ECDHE-ECDSA-CHACHA20-POLY1305<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果客户端硬件没有 AES 优化，服务器就会顺着客户端的意思，优先选择与 AES 等价的 ChaCha20 算法，让客户端能够快一点。</p> <p>全部配置完成后，你可以访问 <a href="https://www.ssllabs.com/" target="_blank" rel="noopener noreferrer">SSLLabs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 网站，测试网站的安全程度，它会模拟多种客户端发起测试，打出一个综合的评分。</p> <p>下图就是 GitHub 网站的评分结果：</p> <p><img src="/notebook/assets/img/a662d410dfdaa8ab44b36cbb68ab8d1b.a662d410.png" alt="img"></p> <h2 id="服务器名称指示"><a href="#服务器名称指示" class="header-anchor">#</a> 服务器名称指示</h2> <p>配置 HTTPS 服务时还有一个“虚拟主机”的问题需要解决。</p> <p>在 HTTP 协议里，多个域名可以同时在一个 IP 地址上运行，这就是 <strong>虚拟主机</strong>，Web 服务器会使用请求头里的 Host 字段来选择。</p> <p>但在 HTTPS 里，<strong>因为请求头只有在 TLS 握手之后才能发送</strong> ，<strong>在握手时就必须选择虚拟主机对应的证书</strong> ，TLS 无法得知域名的信息，就只能用 IP 地址来区分。所以，最早的时候每个 HTTPS 域名必须使用独立的 IP 地址，非常不方便。</p> <p>那么怎么解决这个问题呢？</p> <p>这还是得用到 TLS 的「扩展」，给协议加个 <strong>SNI</strong>（Server Name Indication）的补充条款 。它的作用和 Host 字段差不多，客户端会在 <code>Client Hello</code> 时带上域名信息，这样服务器就可以根据名字而不是 IP 地址来选择证书。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Extension: server_name <span class="token punctuation">(</span>len<span class="token operator">=</span><span class="token number">19</span><span class="token punctuation">)</span>
    Server Name Indication extension
        Server Name Type: host_name <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        Server Name: www.chrono.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Nginx 很早就基于 SNI 特性支持了 HTTPS 的虚拟主机，但在 OpenResty 里可还以编写 Lua 脚本，利用 Redis、MySQL 等数据库更灵活快速地加载证书。</p> <h2 id="重定向跳转"><a href="#重定向跳转" class="header-anchor">#</a> 重定向跳转</h2> <p>现在有了 HTTPS 服务，但原来的 HTTP 站点也不能马上弃用，还是会有很多网民习惯在地址栏里直接敲域名（或者是旧的书签、超链接），默认使用 HTTP 协议访问。</p> <p>所以，之前讲解过的的 <strong>重定向跳转</strong> 技术了，把不安全的 HTTP 网址用 301 或 302 重定向到新的 HTTPS 网站，这在 Nginx 里也很容易做到，使用 return 或 rewrite 都可以。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>             <span class="token comment"># 永久重定向</span>
rewrite ^  https://<span class="token variable">$host</span><span class="token variable">$request_uri</span> permanent<span class="token punctuation">;</span>   <span class="token comment"># 永久重定向</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>但这种方式有两个问题。一个是重定向增加了网络成本，多出了一次请求；另一个是存在安全隐患，重定向的响应可能会被中间人窜改，实现 <strong>会话劫持</strong> ，跳转到恶意网站。</p> <p>不过有一种叫 <strong>HSTS</strong>（HTTP 严格传输安全，HTTP Strict Transport Security）的技术可以消除这种安全隐患。HTTPS 服务器需要在发出的响应头里添加一个 <strong>Strict-Transport-Security</strong> 的字段，再设定一个有效期，例如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Strict-Transport-Security: max-age<span class="token operator">=</span><span class="token number">15768000</span><span class="token punctuation">;</span> includeSubDomains
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这相当于告诉浏览器：我这个网站必须严格使用 HTTPS 协议，在半年之内（182.5 天）都不允许用 HTTP，你以后就自己做转换吧，不要再来麻烦我了。</p> <p>有了 HSTS 的指示，以后浏览器再访问同样的域名的时候就会自动把 URI 里的 <code>http</code> 改成 <code>https</code> ，直接访问安全的 HTTPS 网站。这样中间人就失去了攻击的机会，而且对于客户端来说也免去了一次跳转，加快了连接速度。</p> <p>比如，如果在实验环境的配置文件里用 <code>add_header</code> 指令添加 HSTS 字段：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>add_header Strict-Transport-Security max-age<span class="token operator">=</span><span class="token number">15768000</span><span class="token punctuation">;</span> <span class="token comment">#182.5days</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>那么 Chrome 浏览器只会在第一次连接时使用 HTTP 协议，之后就会都走 HTTPS 协议。</p> <h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <p>今天我介绍了一些 HTTPS 迁移的技术要点，掌握了它们你就可以搭建出一个完整的 HTTPS 站点了。</p> <p>但想要实现大型网站的 「全站 HTTPS」还是需要有很多的细枝末节的工作要做，比如使用 CSP（Content Security Policy）的各种指令和标签来配置安全策略，使用反向代理来集中「卸载」SSL，话题太大，以后有机会再细谈吧。</p> <p>简单小结一下今天的内容：</p> <ol><li>从 HTTP 迁移到 HTTPS 是大势所趋，能做就应该尽早做；</li> <li>升级 HTTPS 首先要申请数字证书，可以选择免费好用的 Let’s Encrypt；</li> <li>配置 HTTPS 时需要注意选择恰当的 TLS 版本和密码套件，强化安全；</li> <li>原有的 HTTP 站点可以保留作为过渡，使用 301 重定向到 HTTPS。</li></ol> <h2 id="课下作业"><a href="#课下作业" class="header-anchor">#</a> 课下作业</h2> <ol><li>结合你的实际工作，分析一下迁移 HTTPS 的难点有哪些，应该如何克服？</li> <li>参考上一讲，你觉得配置 HTTPS 时还应该加上哪些部分？</li></ol> <h2 id="拓展阅读"><a href="#拓展阅读" class="header-anchor">#</a> 拓展阅读</h2> <ul><li><p>也有少数知名网站仍然坚持使用 HTTP，例如 nginx. org、 apache.org</p></li> <li><p>SN 使用明文表示域名，也就提前暴露了一部分 Https 的信息，有安全隐患，容易被中间人 <strong>发起拒绝攻击</strong>，被认为是 TLS 盔甲上最后的一个缝隙，目前正在起草 ESN 规范</p></li> <li><p>HSTS 无法防止黑客对第一次访问的攻击，所以 Chrome 等浏览器还内置了一个 HSTS preload 的列表(<code>chrome://net-internals/#hsts</code> )，只要域名在这个列表里，无论何时都会强制使用 Https 访问</p></li> <li><p>HPKP ( Http Public Key Pinning) 是另一种 Https 安全技术，指示客户端固定网站使用的公钥，防止中间人攻击，但因为接受程度过低，现在已经被放弃</p></li> <li><p>如果要支持老的 WindowsXP 和 IE6，可以选择开启 SSLv3 和 RSA、RC4、SHA</p></li> <li><p>之前在实验环境访问 HTTP 协议时可以看到请求头里有 <code>Upgrade- nsecure- Requests:1</code>，它就是 CSP 的一种，表示浏览器支持升级到 Https 协议</p></li> <li><p>文中提到的虚拟主机，跟正向代理，反向代理，有什么区别？</p> <p>虚拟主机与代理没有关系，是 http 服务器里的概念，在一个 ip 地址上存在多个域名（即主机），所以叫「虚拟主机」</p> <p>因为不能用 ip 地址区分，所以就要用 host 字段，区分不同的主机（域名、网站）。</p></li></ul> <h2 id="let-s-encrypt-证书-certbot-启动续期"><a href="#let-s-encrypt-证书-certbot-启动续期" class="header-anchor">#</a> Let’s Encrypt 证书 certbot 启动续期</h2> <p>笔者是在 CentOS7 上测试的，<a href="https://certbot.eff.org/lets-encrypt/centosrhel7-nginx" target="_blank" rel="noopener noreferrer">可以参考 certbot CentOS7 官方安装文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，他的安装文档步骤很详细，简单说有以下两步：</p> <ol><li>安装 snapd，文档中给出了 snapd 的官方安装文档，照着命令做即可</li> <li>安装 certbot</li></ol> <p>安装好 Certbot 后，可以使用 Certbot，步骤如下：</p> <ol><li><p>先配置 nginx.conf 文件，主要配置是 server_name 也就是你的域名，不然 Certbot 找不到你的配置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    server {
        # 配置好域名
        server_name  mrcode.cn;
        root /usr/servers/notework/release/mrcode-book/;
        # Load configuration files for the default server block.
        include /etc/nginx/default.d/*.conf;

        location / {
        }


        error_page 404 /404.html;
            location = /40x.html {
        }

        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>笔者这里比较简单，是一个静态网页</p></li> <li><p>运行 certbot</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>certbot --nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这一步会有两种情况：</p> <ol><li>当你没有配置域名的时候，会提示你输入你的域名，然后继续后面的步骤</li> <li>当你配置了域名，会自动进行后面的步骤</li></ol> <p>当配置成功后，后打印出你的证书和私钥路径等信息，笔者这里没有保留下来</p></li> <li><p>测试自动续期程序</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>certbot renew --dry-run
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Cert not due <span class="token keyword">for</span> renewal, but simulating renewal <span class="token keyword">for</span> dry run
Plugins selected: Authenticator nginx, Installer nginx
Simulating renewal of an existing certificate <span class="token keyword">for</span> mrcode.cn
Performing the following challenges:
http-01 challenge <span class="token keyword">for</span> mrcode.cn
Waiting <span class="token keyword">for</span> verification<span class="token punctuation">..</span>.
Cleaning up challenges

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
new certificate deployed with reload of nginx server<span class="token punctuation">;</span> fullchain is
/etc/letsencrypt/live/mrcode.cn/fullchain.pem
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Congratulations, all simulated renewals succeeded: 
  /etc/letsencrypt/live/mrcode.cn/fullchain.pem <span class="token punctuation">(</span>success<span class="token punctuation">)</span>
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>上述自己翻译下，大概意思是，证书还未到期，提供模拟信息给你预览。说明后续自动续期的时候应该没有什么问题</p></li> <li><p>自动续期任务确定</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># certbot 安装 https 后，会将定时任务写入以下目录之一</span>
/etc/crontab/
/etc/cron.*/*

<span class="token comment"># 可以使用如下命令查看任务列表</span>
systemctl list-timers
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token comment"># systemctl list-timers</span>
NEXT                         LEFT          LAST                         PASSED  UNIT                         ACTIVATES
Thu <span class="token number">2021</span>-03-11 <span class="token number">11</span>:48:00 CST  1h 28min left n/a                          n/a     snap.certbot.renew.timer     snap.certbot.renew.service
Thu <span class="token number">2021</span>-03-11 <span class="token number">23</span>:06:09 CST  12h left      Wed <span class="token number">2021</span>-03-10 <span class="token number">23</span>:06:09 CST  11h ago systemd-tmpfiles-clean.timer systemd-tmpfiles-clean.service
<span class="token comment"># 第一个任务就是续期的任务，证明也没有问题</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol> <p>笔者这里生成的配置文件如下</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># For more information on configuration, see:</span>
<span class="token comment">#   * Official English Documentation: http://nginx.org/en/docs/</span>
<span class="token comment">#   * Official Russian Documentation: http://nginx.org/ru/docs/</span>

user nginx<span class="token punctuation">;</span>
worker_processes auto<span class="token punctuation">;</span>
error_log /var/log/nginx/error.log<span class="token punctuation">;</span>
pid /run/nginx.pid<span class="token punctuation">;</span>

<span class="token comment"># Load dynamic modules. See /usr/share/nginx/README.dynamic.</span>
include /usr/share/nginx/modules/*.conf<span class="token punctuation">;</span>

events <span class="token punctuation">{</span>
    worker_connections <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    log_format  main  <span class="token string">'<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local</span>] &quot;<span class="token variable">$request</span>&quot; '</span>
                      <span class="token string">'<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> &quot;<span class="token variable">$http_referer</span>&quot; '</span>
                      <span class="token string">'&quot;<span class="token variable">$http_user_agent</span>&quot; &quot;<span class="token variable">$http_x_forwarded_for</span>&quot;'</span><span class="token punctuation">;</span>

    access_log  /var/log/nginx/access.log  main<span class="token punctuation">;</span>

    sendfile            on<span class="token punctuation">;</span>
    tcp_nopush          on<span class="token punctuation">;</span>
    tcp_nodelay         on<span class="token punctuation">;</span>
    keepalive_timeout   <span class="token number">65</span><span class="token punctuation">;</span>
    types_hash_max_size <span class="token number">2048</span><span class="token punctuation">;</span>

    include             /etc/nginx/mime.types<span class="token punctuation">;</span>
    default_type        application/octet-stream<span class="token punctuation">;</span>

    <span class="token comment"># Load modular configuration files from the /etc/nginx/conf.d directory.</span>
    <span class="token comment"># See http://nginx.org/en/docs/ngx_core_module.html#include</span>
    <span class="token comment"># for more information.</span>
    include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span>

    server <span class="token punctuation">{</span>
        server_name  mrcode.cn<span class="token punctuation">;</span>
        root /usr/servers/notework/release/mrcode-book/<span class="token punctuation">;</span>
        <span class="token comment"># Load configuration files for the default server block.</span>
        include /etc/nginx/default.d/*.conf<span class="token punctuation">;</span>

        location / <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        error_page <span class="token number">404</span> /404.html<span class="token punctuation">;</span>
            location <span class="token operator">=</span> /40x.html <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>

        error_page <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html<span class="token punctuation">;</span>
            location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token comment"># 最主要的是增加了下面的配置</span>
    listen <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:443 ssl <span class="token assign-left variable">ipv6only</span><span class="token operator">=</span>on<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    listen <span class="token number">443</span> ssl<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_certificate /etc/letsencrypt/live/mrcode.cn/fullchain.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_certificate_key /etc/letsencrypt/live/mrcode.cn/privkey.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    <span class="token comment"># 注意这里的配置文件，上面文章中说到的一些配置参数，在这个文件中基本都有配置了</span>
    include /etc/letsencrypt/options-ssl-nginx.conf<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>

<span class="token punctuation">}</span>




	<span class="token comment"># 还有这里的配置，将 http 转发到  https</span>
    server <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">=</span> mrcode.cn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token comment"># managed by Certbot</span>


        listen       <span class="token number">80</span> default_server<span class="token punctuation">;</span>
        listen       <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80 default_server<span class="token punctuation">;</span>
        server_name  mrcode.cn<span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> <span class="token number">404</span><span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><p>最后一个是关于效果的确认</p> <p><img src="/notebook/assets/img/image-20210311102432156.1dc18aa2.png" alt="image-20210311102432156"></p> <p>该信息是点击小锁头里面有一个证书信息选项，打开后，就是该界面，另外前面说到的证书链如上图所示，mrcode.cn 的证书是 R3 也就是 Let’s Encrypt 签名的，而 Let’s Encrypt 的证书是 ROOT CAT X3 签名的</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zq99299/notebook/edit/man/docs/http-protocol/05/07.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021-05-06 09:26:26</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notebook/http-protocol/05/06.html" class="prev">
        06 | 连接太慢该怎么办 HTTPS 的优化
      </a></span> <span class="next"><a href="/notebook/http-protocol/06/01.html">
        01 | 时代之风：HTTP/2 特性概览
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/notebook/assets/js/app.b6298c27.js" defer></script><script src="/notebook/assets/js/2.64eb5107.js" defer></script><script src="/notebook/assets/js/59.5bb43d22.js" defer></script><script src="/notebook/assets/js/50.da39fd24.js" defer></script>
  </body>
</html>
